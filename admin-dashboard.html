<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Library</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center">
      <h1>ðŸ“Š Admin Dashboard</h1>
      <a href="/admin.html" class="btn">Back to Admin</a>
    </div>
  </header>

  <main class="wrap grid grid-3">
    <section class="card">
      <h3>Books</h3>
      <table class="table" id="booksTable">
        <thead><tr><th>ID</th><th>Title</th><th>Author</th><th>Available</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="card">
      <h3>Issued (History)</h3>
      <table class="table" id="issuedTable">
        <thead><tr><th>ID</th><th>User</th><th>Book</th><th>Issued</th><th>Returned</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="card">
      <h3>Pending Requests</h3>
      <table class="table" id="reqTable">
        <thead><tr><th>ID</th><th>Type</th><th>User</th><th>Book</th><th>Asked</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script>
    async function getJSON(url){ const r=await fetch(url); if(!r.ok) throw new Error("req failed"); return r.json(); }

    async function load(){
      const books = await getJSON("/api/books");
      const bBody = document.querySelector("#booksTable tbody");
      bBody.innerHTML = books.map(b => `<tr><td>${b.id}</td><td>${b.title}</td><td>${b.author}</td><td>${b.available}</td></tr>`).join("");

      const issued = await getJSON("/api/issued").catch(()=>[]);
      const iBody = document.querySelector("#issuedTable tbody");
      iBody.innerHTML = (issued||[]).map(i => `<tr>
        <td>${i.id}</td><td>${i.username}</td><td>${i.title}</td><td>${i.issue_date}</td><td>${i.return_date || "-"}</td>
      </tr>`).join("");

      const reqs = await getJSON("/api/requests").catch(()=>[]);
      const rBody = document.querySelector("#reqTable tbody");
      rBody.innerHTML = (reqs||[]).map(r => `<tr>
        <td>${r.id}</td><td>${r.type}</td><td>${r.username}</td><td>${r.title}</td><td>${new Date(r.requested_at).toLocaleString()}</td>
      </tr>`).join("");
    }
    load();
  </script>
</body>
</html>
